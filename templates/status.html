<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="icon" href="{{ url_for('static', filename='images/Kalasin_University_Seal.svg.png') }}" type="image/x-icon">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: white;
            color: black;
        }
        .container-custom {
            background: #ffffff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            margin-top: 20px;
        }
        .status-approved {
            color: green;
            font-weight: bold;
        }
        .status-pending {
            color: orange;
            font-weight: bold;
        }
        .navbar {
            background:  #000000;
            backdrop-filter: blur(10px);
        }

        .timeline {
            position: relative;
            margin: 20px 0;
            padding: 0;
            list-style: none;
        }

        .timeline::after {
            content: '';
            position: absolute;
            left: 50px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #D9D9D9;
            border-radius: 2px;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 60px;
            padding-left: 80px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 30px;
            width: 20px;
            height: 20px;
            background-color: #007bff;
            border: 3px solid #ffffff;
            box-shadow: 0 0 0 2px #007bff;
            border-radius: 50%;
            top: 0;
        }

        .timeline-icon {
            position: absolute;
            left: 15px;
            top: -10px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #ffffff;
            border: 2px solid #007bff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #007bff;
            font-size: 1.5rem;
            z-index: 1;
        }

        .timeline-item.completed::before {
            background-color: #28a745;
            box-shadow: 0 0 0 2px #28a745;
        }

        .timeline-item.in-progress::before {
            background-color: #ffc107;
            box-shadow: 0 0 0 2px #ffc107;
        }

        .timeline-item.failed::before {
            background-color: #dc3545;
            box-shadow: 0 0 0 2px #dc3545;
        }
        button:focus,
        button:active,
        .btn:focus,
        .btn:active {
        outline: none !important;
        box-shadow: none !important;
    }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand ms-2" href="{{ url_for('user_dashboard') }}">
                <img src="https://upload.wikimedia.org/wikipedia/th/thumb/4/4e/Kalasin_University_Seal.svg/1200px-Kalasin_University_Seal.svg.png" alt="Kalasin University Logo" style="height: 50px; margin-right: 10px;">
                <strong>Kalasin University</strong>
            </a>
            <div class="ms-auto d-flex">
                <a href="{{ url_for('status') }}" class="btn btn-primary fw-bold px-4 py-2 me-2">
                    <i class="fas fa-chart-line"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
                </a>
                <a href="{{ url_for('logout') }}"
                class="btn btn-danger fw-bold px-4 py-2">
                <i class="fas fa-sign-out-alt"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                -</a>

            </div>
        </div>
    </nav>

    <div class="container container-custom mt-5">
        <h2>üìÑ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>

        <div id="fileStatusContainer">
            <div class="accordion mt-3" id="fileStatusAccordion">
                {% if files %}
                    {% for file in files %}
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="heading{{ file.id }}">
                                <button class="accordion-button {% if file.status != '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' %}collapsed{% endif %}" 
                                        type="button" data-bs-toggle="collapse" 
                                        data-bs-target="#collapse{{ file.id }}" 
                                        aria-expanded="false" aria-controls="collapse{{ file.id }}">
                                    üìÑ {{ file.filename }} - 
                                    <span id="status-{{ file.id }}" class="{% if file.status == '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' %}status-approved{% else %}status-pending{% endif %}">
                                        {{ file.status }}
                                    </span>
                                </button>
                            </h2>
                            <div id="collapse{{ file.id }}" class="accordion-collapse collapse {% if file.status == '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' %}show{% endif %}" 
                                 aria-labelledby="heading{{ file.id }}" data-bs-parent="#fileStatusAccordion">


                                 

                                <!-- ‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå -->
                                <div class="accordion-body">
                                    <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå:</strong> {{ file.filename }}</p>
                                    
                                    
                                    <!-- (1) ‡∏õ‡∏∏‡πà‡∏° "‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"  -->
                                    <button class="btn btn-info btn-sm mb-2" 
                                            type="button"
                                            data-bs-toggle="collapse"
                                            data-bs-target="#detail_{{ file.id }}"
                                            aria-expanded="false"
                                            aria-controls="detail_{{ file.id }}">
                                        ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                                    </button>

                                    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á) -->
                                <form action="{{ url_for('delete_file', file_id=file.id) }}" method="POST" 
                                    onsubmit="return confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ?');" class="d-inline-block mb-2">
                                <button type="submit" class="btn btn-danger btn-sm">
                                    <i class="fas fa-trash-alt"></i> ‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå
                                </button>
                                </form>

                                        
                                    
                                    <!-- (2) ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á -->
                                    <div id="detail_{{ file.id }}" class="collapse">
                                        <ul class="timeline">
                                            
                                            <!-- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ -->
                                            <li class="timeline-item completed">
                                                <div class="timeline-icon">
                                                    <i class="fa-solid fa-upload"></i>
                                                </div>
                                                <h5>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß</h5>
                                                <span class="text-muted">
                                                    {{ file.upload_date.strftime('%d/%m/%Y') }} ‡πÄ‡∏ß‡∏•‡∏≤ {{ file.upload_date.strftime('%H:%M:%S') }}
                                                </span>
                                                <p>‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß</p>
                                            </li>
                                            
                                            <!-- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Ñ‡∏ì‡∏∞‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ -->
                                            <li class="timeline-item {% if file.review_date %}completed{% else %}in-progress{% endif %}">
                                                <div class="timeline-icon">
                                                    <i class="fa-solid fa-check"></i>
                                                </div>
                                                <h5>‡∏Ñ‡∏ì‡∏∞‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h5>
                                                <span class="text-muted">
                                                    {% if file.review_date %}
                                                        {{ file.review_date.strftime('%d/%m/%Y') }} ‡πÄ‡∏ß‡∏•‡∏≤ {{ file.review_date.strftime('%H:%M:%S') }}
                                                    {% else %}
                                                        ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                                                    {% endif %}
                                                </span>
                                                <p>
                                                    {% if file.review_date %}
                                                        ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ñ‡∏π‡∏Å‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÇ‡∏î‡∏¢‡∏Ñ‡∏ì‡∏∞
                                                    {% else %}
                                                        ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ì‡∏∞
                                                    {% endif %}
                                                </p>
                                            </li>
                                            
                                            <!-- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ -->
                                            <li class="timeline-item {% if file.approve_date %}{% if file.status == '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' %}completed{% elif file.status == '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' %}failed{% endif %}{% else %}in-progress{% endif %}">
                                                <div class="timeline-icon">
                                                    <i class="fa-solid fa-university"></i>
                                                </div>
                                                <h5>‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h5>
                                                <span class="text-muted">
                                                    {% if file.approve_date %}
                                                        {{ file.approve_date.strftime('%d/%m/%Y') }} ‡πÄ‡∏ß‡∏•‡∏≤ {{ file.approve_date.strftime('%H:%M:%S') }}
                                                    {% else %}
                                                        ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                                                    {% endif %}
                                                </span>
                                                <p>
                                                    {% if file.approve_date %}
                                                        {% if file.status  %}
                                                            ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ñ‡∏π‡∏Å‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÇ‡∏î‡∏¢‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢
                                                        {% elif file.status%}
                                                            ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
                                                        {% endif %}
                                                    {% else %}
                                                        ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢
                                                    {% endif %}
                                                </p>
                                            </li>
                                        </ul>
                                    </div>
                                    {% if file.status == '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' and file.comment %}
                                    <div class="alert alert-danger mt-3">
                                    <i class="fas fa-comment-dots"></i>
                                    <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> {{ file.comment }}
                                    </div>
                                    {% endif %}
                                    {% if file.status == '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' %}
    <form action="{{ url_for('reupload_file', file_id=file.id) }}" method="POST"
          enctype="multipart/form-data" class="mt-2 d-flex gap-2 align-items-end">

        <div class="flex-grow-1">
            <label class="form-label mb-1">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà:</label>
            <input type="file" name="new_file" class="form-control form-control-sm" required>
        </div>

        <button type="submit" class="btn btn-sm btn-success">
            <i class="fas fa-upload"></i> ‡∏™‡πà‡∏á‡πÉ‡∏´‡∏°‡πà
        </button>
    </form>
{% endif %}


                                    
                                    
                                    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏° -->
                                    <a href="{{ url_for('uploaded_file', filename=file.filename) }}" 
                                       class="btn btn-sm btn-primary" target="_blank">
                                        <i class="fas fa-eye"></i> ‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå
                                    </a>
                                </div>
                                
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted">‚õî ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</p>
                {% endif %}
            </div>
        </div>

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>  
</html>
