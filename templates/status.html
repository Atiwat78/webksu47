<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: white;
            color: black;
        }
        .container-custom {
            background: #ffffff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            margin-top: 20px;
        }
        .status-approved {
            color: green;
            font-weight: bold;
        }
        .status-pending {
            color: orange;
            font-weight: bold;
        }
        .navbar {
            background:  #000000;
            backdrop-filter: blur(10px);
        }

        /* =====================
           CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏≥‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå
        ===================== */
        .timeline {
          position: relative;
          margin: 20px 0;
          padding: 0;
          list-style: none;
        }
        .timeline::after {
          content: '';
          position: absolute;
          left: 30px;
          top: 0;
          bottom: 0;
          width: 4px;
          background: #D9D9D9;
          border-radius: 2px;
        }
        .timeline-item {
          position: relative;
          margin-bottom: 40px;
          padding-left: 60px;
        }
        .timeline-item::before {
          content: '';
          position: absolute;
          left: 22px;
          width: 16px;
          height: 16px;
          background-color: #007bff;
          border: 3px solid #ffffff;
          box-shadow: 0 0 0 2px #007bff;
          border-radius: 50%;
          top: 0;
        }
        .timeline-icon {
          position: absolute;
          left: 0;
          top: -5px;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          background-color: #ffffff;
          border: 2px solid #007bff;
          display: flex;
          align-items: center;
          justify-content: center;
          color: #007bff;
          font-size: 1.2rem;
          z-index: 1;
        }
        .timeline-item.completed::before {
          background-color: #28a745;
          box-shadow: 0 0 0 2px #28a745;
        }
        .timeline-item.in-progress::before {
          background-color: #ffc107;
          box-shadow: 0 0 0 2px #ffc107;
        }
        .timeline-item.failed::before {
          background-color: #dc3545;
          box-shadow: 0 0 0 2px #dc3545;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand ms-2" href="{{ url_for('user_dashboard') }}">
                <img src="https://upload.wikimedia.org/wikipedia/th/thumb/4/4e/Kalasin_University_Seal.svg/1200px-Kalasin_University_Seal.svg.png" alt="Kalasin University Logo" style="height: 50px; margin-right: 10px;">
                <strong>Kalasin University</strong>
            </a>
            <div class="ms-auto d-flex">
                <a href="{{ url_for('status') }}" class="btn btn-primary fw-bold px-4 py-2 me-2">
                    <i class="fas fa-chart-line"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
                </a>
                <a href="#" onclick="logout()" class="btn btn-danger fw-bold px-4 py-2">
                    <i class="fas fa-sign-out-alt"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                </a>
            </div>
        </div>
    </nav>

    <div class="container container-custom mt-5">
        <h2>üìÑ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
    
        <div id="fileStatusContainer">
            <div class="accordion mt-3" id="fileStatusAccordion">
                {% if files %}
                    {% for file in files %}
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="heading{{ file.id }}">
                                <button class="accordion-button {% if file.status != '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' %}collapsed{% endif %}" 
                                        type="button" data-bs-toggle="collapse" 
                                        data-bs-target="#collapse{{ file.id }}" 
                                        aria-expanded="false" aria-controls="collapse{{ file.id }}">
                                    üìÑ {{ file.filename }} - 
                                    <span id="status-{{ file.id }}" class="{% if file.status == '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' %}status-approved{% else %}status-pending{% endif %}">
                                        {{ file.status }}
                                    </span>
                                </button>
                            </h2>
                            <div id="collapse{{ file.id }}" class="accordion-collapse collapse {% if file.status == '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' %}show{% endif %}" 
                                 aria-labelledby="heading{{ file.id }}" data-bs-parent="#fileStatusAccordion">
                                
                                <!-- ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô "‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå" -->
                                <div class="accordion-body">
                                    <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå:</strong> {{ file.filename }}</p>
                                    
                                    <ul class="timeline">
                                        <!-- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 3 ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡∏•‡∏±‡∏Å: ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î -> ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö -> ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ -->
                                        <li class="timeline-item completed">
                                            <div class="timeline-icon">
                                                <i class="fas fa-upload"></i>
                                            </div>
                                            <h5>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß</h5>
                                            <div class="text-muted" style="font-size: 0.9rem;">{{ file.upload_date }}</div>
                                            <p>‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</p>
                                        </li>
                                        
                                        <li class="timeline-item 
                                            {% if file.status == '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö' %}in-progress
                                               {% elif file.status in ['‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß','‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'] %}completed
                                               {% else %}in-progress
                                            {% endif %}">
                                            <div class="timeline-icon">
                                                <i class="fas fa-spinner"></i>
                                            </div>
                                            <h5>‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h5>
                                            <div class="text-muted" style="font-size: 0.9rem;">{{ file.review_date if file.review_date else '---' }}</div>
                                            <p>‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                                        </li>

                                        <li class="timeline-item
                                            {% if file.status == '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' %}completed
                                               {% elif file.status == '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' %}failed
                                               {% else %}in-progress
                                            {% endif %}">
                                            <div class="timeline-icon">
                                                <i class="fas 
                                                    {% if file.status == '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' %}fa-check
                                                    {% elif file.status == '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' %}fa-times
                                                    {% else %}fa-hourglass-half
                                                    {% endif %}">
                                                </i>
                                            </div>
                                            <h5>
                                                {% if file.status == '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' %}
                                                    ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß
                                                {% elif file.status == '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' %}
                                                    ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                                                {% else %}
                                                    ‡∏£‡∏≠‡∏ú‡∏•‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                                                {% endif %}
                                            </h5>
                                            <div class="text-muted" style="font-size: 0.9rem;">
                                                {% if file.status in ['‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß','‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'] %}
                                                    {{ file.approve_date if file.approve_date else '---' }}
                                                {% else %}
                                                    ---
                                                {% endif %}
                                            </div>
                                            <p><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô:</strong> 
                                               {{ file.comment if file.comment else '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏' }}
                                            </p>
                                        </li>
                                    </ul>

                                    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå -->
                                    <a href="{{ url_for('uploaded_file', filename=file.filename) }}" class="btn btn-sm btn-primary" target="_blank">
                                        <i class="fas fa-eye"></i> ‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted">‚õî ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <script>
        function fetchStatusUpdates() {
            fetch("{{ url_for('status') }}")
                .then(response => response.text())
                .then(html => {
                    document.querySelector('#fileStatusContainer').innerHTML = 
                        new DOMParser().parseFromString(html, 'text/html').querySelector('#fileStatusContainer').innerHTML;
                })
                .catch(error => console.error('Error:', error));
        }

        setInterval(fetchStatusUpdates, 100000); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏∏‡∏Å 1 ‡∏ô‡∏≤‡∏ó‡∏µ

        function logout() {
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ logout
            window.location.href = "{{ url_for('logout') }}";

            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå session history ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ login
            setTimeout(function () {
                window.location.replace("{{ url_for('login') }}");
            }, 100);
        }

        // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
        (function () {
            window.history.pushState(null, "", window.location.href);
            window.onpopstate = function () {
                window.history.pushState(null, "", window.location.href);
            };
        })();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>  
</html>
